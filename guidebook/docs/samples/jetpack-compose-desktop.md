# JetPack Compose Desktop

This config imports config generated by [the Conveyor Gradle plugin](../configs/maven-gradle.md#reading-configuration-from-gradle).

## Icons

On Windows, JetPack Compose Desktop expects to set the window icon itself, rather than having it be taken from the EXE file. The ICO file is always placed in the `app/app.ico` path. You can use code like this to ensure your window gets the correct icons:

```kotlin
fun main() {
  singleWindowApplication(
        title = "Example app version ${System.getProperty("app.version")}",
        icon = loadIcon()
  ) { .... }
}

fun loadIcon(): Painter? {
    // app.dir is set when packaged to point at our collected inputs.
    val appDirProp = System.getProperty("app.dir")
    val appDir = appDirProp?.let { Path.of(it) } ?: return null
    val iconPath = appDir.resolve("app.ico")
    return if (iconPath.exists()) {
        BitmapPainter(iconPath.inputStream().buffered().use { loadImageBitmap(it) })
    } else {
        null
    }
}
```

## conveyor.conf

```hocon
include required("/stdlib/jdk/17/openjdk.conf")   // Use a stock OpenJDK Java 17 runtime.
include required("generated.conveyor.conf")       // Generated by running gradle :writeConveyorConfig

// Define some custom values for icons.
icons-path = images
square-icons = "hydraulic-icon-square-*.png"
rounded-icons = "hydraulic-icon-rounded-*.png"

app {
  display-name = Compose Sample App
  fsname = compose-sample
  
  // Import rounded icons by default.
  inputs += ${icons-path}/${rounded-icons} -> .
  icons = "hydraulic-icon-rounded-*"

  // Tell the app its own version.
  jvm.options += "-Dversion="${app.version}

  // But Windows wants square icons.
  windows {
    inputs += ${icons-path}/${square-icons}
    icons = ${square-icons}
  }

  // This is where we'll put the packages and update feeds, plus what image to use on the download 
  site {
    base-url = downloads.hydraulic.dev/compose-sample
    inputs = [ ${icons-path}/hydraulic-icon-rounded-256.png -> logo.png ]
    icons = logo.png
  }

  // Login details for the GateKeeper servers. App specific password will be in a separate file.
  mac.notarization {
    team-id = XXXXXXXXXX
    apple-id = "user@host.com"
  }
}
```

## build.gradle.kts

```kotlin
import org.jetbrains.kotlin.gradle.dsl.KotlinJvmCompile

plugins {
    kotlin("jvm") version "1.6.10"
    id("org.jetbrains.compose") version "1.0.1"
    id("dev.hydraulic.conveyor") version "0.9.8"
}

version = "1.0"
group = "dev.hydraulic.samples"

repositories {
    mavenCentral()
    google()
    maven {
        url = uri("https://maven.pkg.jetbrains.space/public/p/compose/dev")
        name = "Compose for Desktop DEV"
    }
}

compose.desktop {
    application {
        mainClass = "MainKt"

        nativeDistributions {
            vendor = "Hydraulic Software"
            description = "An example of how to package a Compose Desktop app with Conveyor"
        }
    }
}

dependencies {
    // Add the Compose Desktop libraries specific to each platform to machine-specific dependency configurations.
    // The one that matches the current Gradle build host will be added to 'implementation' automatically, so this is sufficient.
    linuxAmd64(compose.desktop.linux_x64)
    macAmd64(compose.desktop.macos_x64)
    macAarch64(compose.desktop.macos_arm64)
    windowsAmd64(compose.desktop.windows_x64)
}
```
